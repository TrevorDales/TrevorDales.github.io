<!doctype html><html lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><title>
        Lab 3
    </title><link href="https://TrevorDales.github.io/ atom.xml" title="Trevor Dales" rel=alternate type=application/atom+xml><link href=https://TrevorDales.github.io/main.css media=screen rel=stylesheet><meta content="Hi! My name is Trevor." name=description><meta content="Hi! My name is Trevor." name=description><meta content="index, nofollow" name=robots><meta content="Trevor Dales" property=og:title><meta content=article property=og:type><meta content=https://TrevorDales.github.io/MAE4190/lab3/ property=og:url><meta content="Hi! My name is Trevor." property=og:description><meta content="Trevor Dales" property=og:site_name><meta content="default-src 'self' ws://127.0.0.1:1024/; img-src 'self' https://*; script-src 'self'; style-src 'self'; font-src 'self'; frame-src https://www.youtube.com https://player.vimeo.com;" http-equiv=Content-Security-Policy><body><header><div class=navbar><div class="nav-title nav-navs"><a class="nav-links home-title" href=https://TrevorDales.github.io>Trevor Dales</a></div><nav class="nav-title nav-navs"><a class=nav-links href=/MAE4190> <img 4190 alt=MAE height=15 src=/menu_icon/projects.png width=15> MAE 4190</a><a class=nav-links href=/contact/contact> <img alt=Contact height=15 src=/menu_icon/resume.png width=15> Contact</a></nav><nav class="socials nav-navs"><label class=theme-switcher for=themeswitch><div class=background></div> <input id=themeswitch type=checkbox> <div class=switch><img alt="theme switch to dark" class=moon src=/menu_icon/moon.png><img alt="theme switch to light" class=sun src=/menu_icon/sun.png></div></label></nav></div></header><div class=content><main><article><div class=title><h2>Lab 3</h2><div class=meta>Posted on <time>2025-02-25</time></div></div><section class=body><br><h1 id=establishing-the-time-of-flight-tof-sensor>Establishing the Time of Flight (TOF) sensor</h1><p>The robot will use two TOF sensors to collect data from the environment. I decided to mount one sensor on the front of the car for obstacle detection in the path of motion. I will put the other sensor on the side of the car, primarily for improved mapping and the ability to drive along a wall. A potential weakness is an inability to see behind the robot. <br><p>In order to use two sensors with the same address, I used the XSHUT pin on a sensor to shut it off momentarily. I modified the address of the other sensor, and was then able to reinitialize the orignal sensor. After this, the sensors can function at the same time. <br><pre class=z-code><code><span class="z-text z-plain">digitalWrite(SHUTDOWN_PIN, LOW); // Shut down TOF2
</span><span class="z-text z-plain">distanceSensor1.begin();
</span><span class="z-text z-plain">distanceSensor1.setI2CAddress(0xf5);
</span><span class="z-text z-plain">distanceSensor1.begin()
</span><span class="z-text z-plain">distanceSensor1.setDistanceModeShort();
</span><span class="z-text z-plain">digitalWrite(SHUTDOWN_PIN, HIGH); // Restart TOF2 
</span><span class="z-text z-plain">distanceSensor2.begin() 
</span><span class="z-text z-plain">distanceSensor2.setDistanceModeShort();
</span></code></pre><br> Per the TOF data sheet, the default I2C address for the sensor is 0x52 (0b 0101 0010 in hexadecimal). However, when checking the sensor address with the artemis, the scanned I2C address is 0x29 (0b 0010 1001). This discrepancy arises because I2C addresses are conventionally 7-bit, while the datasheet provides an 8-bit address that includes the read/write bit. In I2C communication, the 7-bit address is left-shifted by one bit to accommodate this read/write bit, effectively converting 0x29 into 0x52. Thus, the scanned address correctly corresponds to the deviceâ€™s datasheet address, as it is simply a shifted representation. <div align=center><img alt="Rising Temperature Graph" src=/Lab3/i2cscan.png style=display:block><img alt="Rising Temperature Graph" src=/Lab3/wiring.png style=display:block><h5 id=wiring-diagram>Wiring Diagram</h5></div><br><p>Next, I soldered the connection and was able to establish a bluetooth connection with the electronics being powered by the battery.</p><img alt="Rising Temperature Graph" src=/Lab3/wiredpic.jpg style=display:block><br><br><br><h1 id=characterizing-the-tof-sensor>Characterizing the TOF sensor</h1><p>I next investigated the consistency and accuracy of the data being collected. I measured out a 5 inch gap and secured the sensor this far from a white cardboard box. I then collected 500 data points to get an idea of what the noise profile of the sensor looked like.<div align=center><img alt="Rising Temperature Graph" src=/Lab3/sensorgap.png style=display:block><h5 id=tof-sensor-secured-5-inches-from-object-the-gap-was-measured-with-a-tape-measure>TOF sensor secured 5 inches from object. The gap was measured with a tape measure.</h5><br><img alt="Rising Temperature Graph" src=/Lab3/shortdist.png style=display:block><h5 id=measurement-distribution-short-mode>Measurement distribution, short mode</h5><br><img alt="Rising Temperature Graph" src=/Lab3/longdist.png style=display:block><h5 id=measurement-distribution-long-mode>Measurement distribution, long mode</h5><br></div><p>I repeated this trial at 20 inches with pretty similar results. My take away from this is that both modes have pretty similar noise profiles, but short mode gets closer to the true distance measurment. For this reason, I'm going to use short mode going forward unless I run into issues at much longer ranges - short mode seemed to work fine for distances under about 4 feet. Otherwise, it's nice to see that the large majority of data points fall within a ~0.1" spread.</p><br><p>Another note from these trials is that the resolution of the measurement is not as high as I initially thought. The number being collected is reported to a thousandth of an inch, but the sensor is not this high resolution. I inititally made the buckets in my histogram much smaller, and the resultant banding shows that the sensor is only reporting distance to the nearest 1/3 of an inch.<div align=center><img alt="Rising Temperature Graph" src=/Lab3/histo.png style=display:block><h5 id=the-large-gaps-between-filled-buckets-in-this-histogram-shows-the-lack-of-resolution-in-the-sensor>The large gaps between filled buckets in this histogram shows the lack of resolution in the sensor.</h5><br></div><h1 id=considering-speed-with-two-sensors>Considering speed with two sensors</h1><p>With the wiring shown above, I was able to get both sensors collecting data at the same time.</p><img alt="Rising Temperature Graph" src=/Lab3/twoTOF.png style=display:block><br><p>I then looped this code snipped to compare the sensor speed to the artemis clock speed:<pre class=z-code><code><span class="z-text z-plain">distanceSensor1.startRanging();
</span><span class="z-text z-plain">distanceSensor2.startRanging();
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">if (distanceSensor1.checkForDataReady())
</span><span class="z-text z-plain">    {
</span><span class="z-text z-plain">    int distance1 = distanceSensor1.getDistance();
</span><span class="z-text z-plain">    distanceSensor1.clearInterrupt();
</span><span class="z-text z-plain">    distanceSensor1.stopRanging();
</span><span class="z-text z-plain">    Serial.print("Distance1: ");
</span><span class="z-text z-plain">    Serial.print(distance1);
</span><span class="z-text z-plain">    Serial.println("   ");
</span><span class="z-text z-plain">    }
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">if (distanceSensor2.checkForDataReady())
</span><span class="z-text z-plain">    {
</span><span class="z-text z-plain">    int distance2 = distanceSensor2.getDistance(); 
</span><span class="z-text z-plain">    distanceSensor2.clearInterrupt();
</span><span class="z-text z-plain">    distanceSensor2.stopRanging();
</span><span class="z-text z-plain">    Serial.print("Distance2: ");
</span><span class="z-text z-plain">    Serial.print(distance2);
</span><span class="z-text z-plain">    Serial.println("   ");
</span><span class="z-text z-plain">    }
</span><span class="z-text z-plain">
</span><span class="z-text z-plain">Serial.print("T: ");
</span><span class="z-text z-plain">Serial.print(millis());
</span><span class="z-text z-plain">Serial.print("   ");
</span><span class="z-text z-plain">Serial.println();
</span></code></pre><div align=center><img alt="Rising Temperature Graph" src=/Lab3/tofdelay.png style=display:block><h5 id=result-of-running-this-code-the-delay-for-each-sensor-seems-to-vary-between-100-200ms-indicating-a-sampling-rate-of-5-10hz-the-artemis-clock-is-20-30x-faster-than-an-individual-sensor-the-sensors-just-take-a-long-time-to-have-data-ready>Result of running this code. The delay for each sensor seems to vary between 100-200ms, indicating a sampling rate of 5-10Hz. The Artemis clock is 20-30x faster than an individual sensor; the sensors just take a long time to have data ready.</h5><br></div><h1 id=final-implementiation-and-plotting>Final implementiation and plotting</h1><p>With all of my sensors now working, I next implemented functions in my Artemis code to collect data. By controlling whether these functions run using flags sent through commands, I have full control over when each sensor is active. Below are graphs of IMU and TOF data, all taken during the same time frame.</p><img alt="Rising Temperature Graph" src=/Lab3/lab3IMU.png style=display:block><img alt="Rising Temperature Graph" src=/Lab3/lab3TOF.png style=display:block><h1 id=collaboration>Collaboration</h1><p>I worked with Jack Long and Lucca Correia extensively. I also referenced Wenyi's website from last year for wiring and utilizing the XSHUT pin. Lastly, I used ChatGPT for error debugging and to speed up plotting.</section></article></main></div><footer><section><nav><a class="nav-links social" rel="noopener noreferrer" href=https://github.com/TrevorDales target=_blank> <img alt=github src=/social_icons/github.svg title=github> </a></nav><nav><span classname=desktop-only>This blog is powered by <a rel="noopener noreferrer" href=https://getzola.org/ target=_blank>Zola</a> with theme by <a rel="noopener noreferrer" href=https://syedzayyan.com/ target=_blank>SZM</a></span></nav></section><script src=https://TrevorDales.github.io/js/main.js></script></footer>